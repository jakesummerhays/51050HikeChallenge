<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <!-- Responsive Meta Tag for Mobile -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>hikechallenge.org</title>

  <style>
    /* --------------------------
       GLOBAL RESETS & BASE
    --------------------------- */
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    body {
      font-family: Arial, sans-serif;
      background-color: #000;
      color: #fff;
    }
    a {
      text-decoration: none;
      color: inherit;
    }

    /* --------------------------
       HEADER (TITLE & LOGO)
    --------------------------- */
    .header {
      display: flex;
      flex-direction: column;
      align-items: center;
      text-align: center;
      margin: 10px auto 15px auto;
      max-width: 95%;
    }
    .site-title {
      font-size: 2em;
      font-weight: bold;
      color: #00BFFF;
      margin-bottom: 10px;
    }
    .logo {
      max-width: 350px;
      height: auto;
    }

    /* --------------------------
       DASHBOARD (WHITE BORDER, TABULAR LAYOUT, CENTERED)
    --------------------------- */
    .dashboard {
      width: 80%;  
      max-width: 560px;
      margin: 0 auto 20px auto;
      border: 1px solid #fff;
      border-radius: 8px;
      padding: 20px;
      text-align: center;
    }
    .dashboard-table {
      display: table;
      margin: 0 auto;
    }
    .dashboard-row {
      display: table-row;
    }
    .dashboard-cell-label,
    .dashboard-cell-count {
      display: table-cell;
      padding: 8px 15px;
      vertical-align: middle;
    }
    .dashboard-cell-label {
      font-size: 1.1em;
      text-align: right;
    }
    .dashboard-cell-count {
      font-size: 1.5em;
      font-weight: bold;
      text-align: right;
      width: 60px;
    }

    /* --------------------------
       SUBMIT BUTTON (Outside Dashboard)
    --------------------------- */
    .submit-link {
      text-align: center;
      margin-bottom: 20px;
    }
    .button {
      display: inline-block;
      padding: 10px 20px;
      background-color: #00BFFF;
      color: #000;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      transition: background 0.3s;
      text-decoration: none;
    }
    .button:hover {
      background-color: #87CEFA;
    }

    /* --------------------------
       SUMMARY PARAGRAPHS
    --------------------------- */
    .summary {
      max-width: 700px;
      margin: 0 auto 20px auto;
      padding: 15px;
      line-height: 1.6;
    }
    .summary p {
      font-size: 1.1em;
      margin-bottom: 10px;
    }

    /* --------------------------
       LIABILITY DISCLAIMER
    --------------------------- */
    .disclaimer {
      max-width: 700px;
      margin: 0 auto;
      padding: 0 15px 15px;
      color: #ccc;
      font-size: 0.9em;
      line-height: 1.4;
      text-align: left;
    }

    /* --------------------------
       FINISHERS (Vertical List Layout)
    --------------------------- */
    .finishers {
      max-width: 700px;
      margin: 20px auto 40px auto;
      padding: 10px;
      text-align: left;
    }
    .finishers h3 {
      text-align: center;
      margin-bottom: 10px;
      font-size: 1.3em;
      color: #fff;
    }
    .finishers-list {
      list-style: none;
      padding: 0;
      margin: 0;
    }
    .finishers-list li {
      background-color: #1a1a1a;
      padding: 10px;
      margin-bottom: 8px;
      border-radius: 6px;
      text-align: center;
      font-size: 1em;
      transition: background-color 0.2s ease;
    }
    .finishers-list li:hover {
      background-color: #333;
    }

    /* --------------------------
       FOOTER (Hidden)
    --------------------------- */
    .footer {
      display: none;
    }

    /* --------------------------
       RESPONSIVE MEDIA QUERY
    --------------------------- */
    @media (max-width: 600px) {
      .dashboard,
      .summary,
      .disclaimer,
      .finishers {
        width: 90%;
        margin: 10px auto;
        padding: 15px;
      }
      .site-title {
        font-size: 1.5em;
      }
      .logo {
        max-width: 70%;
      }
      .dashboard-cell-count {
        width: 50px;
      }
    }
  </style>
</head>
<body>

  <!-- HEADER -->
  <div class="header">
    <div class="site-title">hikechallenge.org</div>
    <img class="logo" src="logo2.jpg" alt="hikechallenge.org Logo" />
  </div>

  <!-- DASHBOARD (with white border, tabular layout, centered) -->
  <div class="dashboard">
    <div class="dashboard-table">
      <div class="dashboard-row">
        <div class="dashboard-cell-label">5 Mile Hikes</div>
        <div class="dashboard-cell-count" id="fiveMileCount">0</div>
      </div>
      <div class="dashboard-row">
        <div class="dashboard-cell-label">10 Mile Hikes</div>
        <div class="dashboard-cell-count" id="tenMileCount">0</div>
      </div>
      <div class="dashboard-row">
        <div class="dashboard-cell-label">50 Mile Hikes</div>
        <div class="dashboard-cell-count" id="fiftyMileCount">0</div>
      </div>
      <div class="dashboard-row">
        <div class="dashboard-cell-label">Total Miles Hiked</div>
        <div class="dashboard-cell-count" id="totalMilesHiked">0</div>
      </div>
    </div>
  </div>

  <!-- Submit button placed below the dashboard -->
  <div class="submit-link">
    <a class="button" href="https://docs.google.com/forms/d/e/1FAIpQLScI2HN5KbJOdWM2WBOHyMxiU0ML5muFDZ3KDP9nkqS3sRoWwg/viewform?usp=dialog" target="_blank">
      Submit Your Hike
    </a>
  </div>

  <!-- SUMMARY -->
  <div class="summary">
    <p>
      In 2025 we started hikechallenge.org with the vision that it becomes a nationwide movement to inspire people of all fitness levels to reconnect with nature, experience the joy of hiking, improve our Health, build Community, and grow in Confidence.
    </p>
    <p>
      Our challenge invites you to embark on three distinct journeys—a 5‑mile, a 10‑mile, and a 50‑mile hike. Please note that the Hike Count Dashboard will only count 1 hike per person in each of the hike distances. Every single hike is a unique personal milestone that adds to our collective journey.
    </p>
    <p>
      Once you’ve completed your hike, please submit it so it’s recorded on the Hike Count Dashboard and so your name shows up on our Finishers list—and then think about whom else might enjoy hiking as well. Your example can help spread the benefits of Health, Nature, Community, and Confidence even further.
    </p>
  </div>

  <!-- DISCLAIMER -->
  <div class="disclaimer">
    <p>
      By submitting YOUR HIKE to hikechallenge.org you acknowledge that your hike was completely voluntary.
      You understand and accept that you do so at your own risk. hikechallenge.org not liable for any
      accidents, injuries, or other incidents that may occur during your hike. If you have any concerns
      about your health or ability to participate, please consult a medical professional before starting.
    </p>
  </div>

  <!-- FINISHERS (Vertical List Layout) -->
  <div class="finishers">
    <h3>Finishers</h3>
    <ul class="finishers-list" id="nameList"></ul>
  </div>

  <script>
    /*************************************************************
     * DO_GET_URL from your Apps Script (ends in /exec)
     *************************************************************/
    const DO_GET_URL = "https://script.google.com/macros/s/AKfycbwDfy9-YWF4J8AUX-L-lvF_oeDWER66K3p9CnM2cPvUmTPrkte45PkZ7ixMvgHcst5fMg/exec";

    /*************************************************************
     * State Abbreviations (if needed)
     *************************************************************/
    const stateAbbreviations = {
      "Alabama": "AL",
      "Alaska": "AK",
      "Arizona": "AZ",
      "Arkansas": "AR",
      "California": "CA",
      "Colorado": "CO",
      "Connecticut": "CT",
      "Delaware": "DE",
      "Florida": "FL",
      "Georgia": "GA",
      "Hawaii": "HI",
      "Idaho": "ID",
      "Illinois": "IL",
      "Indiana": "IN",
      "Iowa": "IA",
      "Kansas": "KS",
      "Kentucky": "KY",
      "Louisiana": "LA",
      "Maine": "ME",
      "Maryland": "MD",
      "Massachusetts": "MA",
      "Michigan": "MI",
      "Minnesota": "MN",
      "Mississippi": "MS",
      "Missouri": "MO",
      "Montana": "MT",
      "Nebraska": "NE",
      "Nevada": "NV",
      "New Hampshire": "NH",
      "New Jersey": "NJ",
      "New Mexico": "NM",
      "New York": "NY",
      "North Carolina": "NC",
      "North Dakota": "ND",
      "Ohio": "OH",
      "Oklahoma": "OK",
      "Oregon": "OR",
      "Pennsylvania": "PA",
      "Rhode Island": "RI",
      "South Carolina": "SC",
      "South Dakota": "SD",
      "Tennessee": "TN",
      "Texas": "TX",
      "Utah": "UT",
      "Vermont": "VT",
      "Virginia": "VA",
      "Washington": "WA",
      "West Virginia": "WV",
      "Wisconsin": "WI",
      "Wyoming": "WY"
    };

    /*************************************************************
     * FETCH DATA FROM SHEETS (doGet) AND RENDER DASHBOARD & FINISHERS
     *************************************************************/
    async function fetchHikeDataFromSheet() {
      try {
        const response = await fetch(DO_GET_URL);
        const submissions = await response.json();

        // Filter out duplicates: only one hike per person per distance
        const uniqueSubmissions = [];
        const seen = {};
        submissions.forEach(entry => {
          const key = entry.name.trim().toLowerCase() + "_" + entry.hikeLength;
          if (!seen[key]) {
            seen[key] = true;
            uniqueSubmissions.push(entry);
          }
        });

        // Sort submissions in ascending order by timestamp (earliest first)
        uniqueSubmissions.sort((a, b) => new Date(a.timestamp) - new Date(b.timestamp));
        
        renderDashboard(uniqueSubmissions);
      } catch (err) {
        console.error("Failed to fetch data from Sheets:", err);
      }
    }

    function renderDashboard(submissions) {
      // Reset counters
      let fiveCount = 0;
      let tenCount = 0;
      let fiftyCount = 0;
      
      // Clear existing finishers list
      const nameListElem = document.getElementById('nameList');
      nameListElem.innerHTML = "";

      // Process each unique submission
      submissions.forEach((entry, index) => {
        if (entry.hikeLength === "5 Mile Hike") fiveCount++;
        else if (entry.hikeLength === "10 Mile Hike") tenCount++;
        else if (entry.hikeLength === "50 Mile Hike") fiftyCount++;

        // Create a Date object and extract Month and Year
        const dateObj = new Date(entry.timestamp);
        const month = dateObj.toLocaleString('default', { month: 'long' });
        const year = dateObj.getFullYear();
        
        // Get state abbreviation if available
        const stateDisplay = stateAbbreviations[entry.state] || entry.state;
        
        // Finisher number (1-based order)
        const finisherNumber = index + 1;
        // Format: "1) Jacob Summerhays - March 2025 - CA"
        const li = document.createElement('li');
        li.textContent = `${finisherNumber}) ${entry.name} - ${month} ${year} - ${stateDisplay}`;
        nameListElem.appendChild(li);
      });

      // Update dashboard counters
      document.getElementById('fiveMileCount').textContent = fiveCount;
      document.getElementById('tenMileCount').textContent = tenCount;
      document.getElementById('fiftyMileCount').textContent = fiftyCount;

      // Calculate total miles and update
      const totalMiles = (fiveCount * 5) + (tenCount * 10) + (fiftyCount * 50);
      document.getElementById('totalMilesHiked').textContent = totalMiles;
    }

    // On page load, fetch existing data from Sheets
    window.onload = fetchHikeDataFromSheet;
  </script>
</body>
</html>